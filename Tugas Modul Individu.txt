//Aplikasi Keuangan Mahasiswa

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

//Variabel record untuk menyimpan data-data input transaksi
struct Record {
	int nominal;
	char posAnggaran[13];
	int ID;
	char jenis[12];
	char deskripsi[50];
};

//Procedure untuk memberikan nilai awal pada variabel record
void inisialisasiRecord(struct Record transaksiMhs[], int indeks){
	//Loop untuk inisialisasi variabel record
		int i;
		for (i = 0; i < 30; i++){
		transaksiMhs[i].nominal = 0;
		transaksiMhs[i].ID = 0;
		strcpy(transaksiMhs[i].posAnggaran, "Kosong");
		strcpy(transaksiMhs[i].jenis, "Kosong");
		strcpy(transaksiMhs[i].deskripsi, "Kosong");
	}
}

//Procedure untuk input jumlah transaksi
void inputjmlTransaksi(int *varJmlTransaksi){
	do {
		printf("Masukkan jumlah aktivitas transaksi : ");
		scanf("%d", varJmlTransaksi);
		while (getchar() != '\n');
		if (*varJmlTransaksi < 0 || *varJmlTransaksi > 30){
			printf("Input tidak boleh kurang dari 0 atau lebih dari 30! Coba lagi!\n\n");
		}
	} while (*varJmlTransaksi < 0 || *varJmlTransaksi > 30);
}

//Procedure untuk input nama pos anggaran
void inputPosAnggaran(struct Record transaksiMhs[], int indeks){
	char varPosAnggaran[13];
	int i = 0;
	printf("Hari ke-%d", indeks + 1);
	printf("\nMasukkan nama pos anggaran (pemasukan untuk jenis pemasukan, makan/transportasi/hiburan/tugas/lainnya untuk jenis pengeluaran) : ");
	fgets(varPosAnggaran, sizeof(varPosAnggaran), stdin);
	varPosAnggaran[strcspn(varPosAnggaran, "\n")] = '\0';
	while (varPosAnggaran[i] != '\0'){
		varPosAnggaran[i] = tolower(varPosAnggaran[i]);
		i++;
	}
	strcpy(transaksiMhs[indeks].posAnggaran, varPosAnggaran);
}

//Procedure untuk input jumlah nominal
void inputNominal(struct Record transaksiMhs[], int indeks){
	int varNominal;
	do {
		printf("\nMasukkan jumlah nominal (jangan menggunakan titik/koma) : ");
		scanf("%d", &varNominal);
		while (getchar() != '\n');
		if (varNominal < 0){
			printf("Input tidak boleh kurang dari 0! Coba lagi!\n\n");
		}
	} while (varNominal < 0);
	transaksiMhs[indeks].nominal = varNominal;
}

//Modul-modul untuk mengecek input nominal pengeluaran
//Procedure untuk mengecek batas nominal biaya makan
void cekBatasNominalMakan(struct Record transaksiMhs[], int indeks){
	int varNominal;
	if (strcmp(transaksiMhs[indeks].posAnggaran, "makan") == 0){
		if (transaksiMhs[indeks].nominal > 300000){
			do {
				printf("Input melebihi batas! Coba lagi!\n");
				printf("Masukkan jumlah nominal (jangan menggunakan titik/koma) : ");
				scanf("%d", &varNominal);
				while (getchar() != '\n');
				if (varNominal < 0 || varNominal > 300000){
					printf("Input tidak boleh kurang dari 0 atau lebih dari 300000! Coba lagi!");
				}
			} while (varNominal < 0 || varNominal > 300000);
		}
	}
	transaksiMhs[indeks].nominal = varNominal;
}

//Procedure untuk mengecek batas nominal biaya transportasi
void cekBatasNominalTrans(struct Record transaksiMhs[], int indeks){
	int varNominal;
	if (strcmp(transaksiMhs[indeks].posAnggaran, "transportasi") == 0){
		if (transaksiMhs[indeks].nominal > 150000){
			do {
				printf("Input melebihi batas! Coba lagi!\n");
				printf("Masukkan jumlah nominal (jangan menggunakan titik/koma) : ");
				scanf("%d", &varNominal);
				while (getchar() != '\n');
				if (varNominal < 0 || varNominal > 150000){
					printf("Input tidak boleh kurang dari 0 atau lebih dari 150000! Coba lagi!");
				}
			} while (varNominal < 0 || varNominal > 150000);
		}
	}
	transaksiMhs[indeks].nominal = varNominal;
}

//Procedure untuk mengecek batas nominal biaya hiburan
void cekBatasNominalHiburan(struct Record transaksiMhs[], int indeks){
	int varNominal;
	if (strcmp(transaksiMhs[indeks].posAnggaran, "hiburan") == 0){
		if (transaksiMhs[indeks].nominal > 100000){
			do {
				printf("Input melebihi batas! Coba lagi!\n");
				printf("Masukkan jumlah nominal (jangan menggunakan titik/koma) : ");
				scanf("%d", &varNominal);
				while (getchar() != '\n');
				if (varNominal < 0 || varNominal > 100000){
					printf("Input tidak boleh kurang dari 0 atau lebih dari 100000! Coba lagi!");
				}
			} while (varNominal < 0 || varNominal > 100000);
		}
	}
	transaksiMhs[indeks].nominal = varNominal;
}

//Procedure untuk mengecek batas nominal biaya Tugas
void cekBatasNominalTugas(struct Record transaksiMhs[], int indeks){
	int varNominal;
	if (strcmp(transaksiMhs[indeks].posAnggaran, "tugas") == 0){
		if (transaksiMhs[indeks].nominal > 100000){
			do {
				printf("Input melebihi batas! Coba lagi!\n");
				printf("Masukkan jumlah nominal (jangan menggunakan titik/koma) : ");
				scanf("%d", &varNominal);
				while (getchar() != '\n');
				if (varNominal < 0 || varNominal > 100000){
					printf("Input tidak boleh kurang dari 0 atau lebih dari 100000! Coba lagi!");
				}
			} while (varNominal < 0 || varNominal > 100000);
		}
	}
	transaksiMhs[indeks].nominal = varNominal;
}

//Procedure untuk mengecek batas nominal biaya lainnya
void cekBatasNominalLain(struct Record transaksiMhs[], int indeks){
	int varNominal;
	if (strcmp(transaksiMhs[indeks].posAnggaran, "lainnya") == 0){
		if (transaksiMhs[indeks].nominal > 50000){
			do {
				printf("Input melebihi batas! Coba lagi!\n");
				printf("Masukkan jumlah nominal (jangan menggunakan titik/koma) : ");
				scanf("%d", &varNominal);
				while (getchar() != '\n');
				if (varNominal < 0 || varNominal > 50000){
					printf("Input tidak boleh kurang dari 0 atau lebih dari 50000! Coba lagi!");
				}
			} while (varNominal < 0 || varNominal > 50000);
		}
	}
	transaksiMhs[indeks].nominal = varNominal;
}

//Procedure untuk menggolongkan jenis
void cekJenisTransaksi(struct Record transaksiMhs[], int indeks){
	if (strcmp(transaksiMhs[indeks].posAnggaran, "pemasukan") == 0){
		strcpy(transaksiMhs[indeks].jenis, "Pemasukan");
	} else {
		strcpy(transaksiMhs[indeks].jenis, "Pengeluaran");
	}
}

//Procedure untuk memberikan deskripsi transaksi
void deskripsiTransaksi(struct Record transaksiMhs[], int indeks){
	char varDeskripsi[100];
	printf("\nDeskripsi dari transaksi : ");
	fgets(varDeskripsi, sizeof(varDeskripsi), stdin);
	varDeskripsi[strcspn(varDeskripsi, "\n")] = '\0';
	strcpy(transaksiMhs[indeks].deskripsi, varDeskripsi);
}
//Procedure untuk memberikan nomor setiap transaksi
void IDTransaksi(struct Record transaksiMhs[], int indeks){
	transaksiMhs[indeks].ID = indeks + 1;
}

//Fungsi untuk menjumlahkan total pemasukan
int jumlahTotalPemasukan(struct Record transaksiMhs[], int indeks){
	int varTotalPemasukan = 0;
	if (strcmp(transaksiMhs[indeks].jenis, "Pemasukan") == 0){
		varTotalPemasukan = varTotalPemasukan + transaksiMhs[indeks].nominal;
	}
	return varTotalPemasukan;
}

//Program Utama
int main(){
	
	//Deklarasi
	struct Record transaksiMhs[30];
	int jmlTransaksi = 0;
	int totalPemasukan;
	int i;
	
	//Inisialisasi data transaksi
	inisialisasiRecord(transaksiMhs, 30);
	inputjmlTransaksi(&jmlTransaksi);
	
	//Mengisi data di variabel record keuangan mahasiswa
	for (i = 0; i < jmlTransaksi; i++){
		//input transaksi
		inputPosAnggaran(transaksiMhs, i);
		inputNominal(transaksiMhs, i);
		
		//Cek batas nominal pengeluaran
		cekBatasNominalMakan(transaksiMhs, i);
		cekBatasNominalTrans(transaksiMhs, i);
		cekBatasNominalHiburan(transaksiMhs, i);
		cekBatasNominalTugas(transaksiMhs, i);
		cekBatasNominalLain(transaksiMhs, i);
		
		//Menggolongkan jenis (pemasukan/pengeluaran)
		cekJenisTransaksi(transaksiMhs, i);
		
		//Memberikan deskripsi untuk setiap transaksi
		deskripsiTransaksi(transaksiMhs, i);
		
		//Memberikan nomor untuk setiap transaksi
		IDTransaksi(transaksiMhs, i);
	}
	//Perhitungan kondisi keuangan
	for (i = 0; i < jmlTransaksi; i++){
		//Menjumlahkan total pemasukan
		totalPemasukan = jumlahTotalPemasukan(transaksiMhs, i);
	}
	
	//Uji output
	printf("\nJumlah transaksi dalam 1 bulan : %d\n", jmlTransaksi);
	for (i = 0; i < jmlTransaksi; i++){
		printf("ID = %d\n", transaksiMhs[i].ID);
		printf("Pos Anggaran = %s\n", transaksiMhs[i].posAnggaran);
		printf("Nominal = %d\n", transaksiMhs[i].nominal);
		printf("Jenis = %s\n", transaksiMhs[i].jenis);
		printf("Deskripsi = %s\n", transaksiMhs[i].deskripsi);
	}
	printf("Total pemasukan : %d", totalPemasukan);
	
	return 0;
}
